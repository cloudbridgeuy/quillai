<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browser Console Testing</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        .console-output {
            background-color: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 20px 0;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .test-button {
            background-color: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background-color: #005a9e;
        }
        .demo-element {
            padding: 15px;
            margin: 10px 0;
            border: 2px dashed #ddd;
            border-radius: 5px;
            background-color: #fafafa;
            min-height: 40px;
        }
    </style>
</head>
<body>
    <h1>üñ•Ô∏è Browser Console and Runtime Testing</h1>
    <p>This page tests attributor functionality in a browser environment with console-like interactions.</p>
    
    <div>
        <button class="test-button" onclick="runBasicTests()">Run Basic Tests</button>
        <button class="test-button" onclick="runConstructorTests()">Test Constructors</button>
        <button class="test-button" onclick="runMethodTests()">Test Methods</button>
        <button class="test-button" onclick="runErrorTests()">Test Error Handling</button>
        <button class="test-button" onclick="runPerformanceTests()">Performance Tests</button>
        <button class="test-button" onclick="clearConsole()">Clear Console</button>
    </div>
    
    <div class="console-output" id="console"></div>
    
    <div class="demo-element" id="demo-element">
        Demo Element - This will be modified by attributors
    </div>
    
    <script type="module">
        let Parchment;
        let consoleDiv;
        
        function log(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? '‚ùå' : type === 'warn' ? '‚ö†Ô∏è' : type === 'success' ? '‚úÖ' : 'üìù';
            consoleDiv.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
            
            // Also log to browser console
            console[type === 'success' ? 'log' : type](message);
        }
        
        window.clearConsole = function() {
            consoleDiv.textContent = '';
        };
        
        async function initialize() {
            try {
                consoleDiv = document.getElementById('console');
                log('üöÄ Initializing Parchment WASM module...');
                
                Parchment = await import('./pkg/quillai_parchment.js');
                await Parchment.default();
                
                log(`‚úÖ Parchment v${Parchment.version()} loaded successfully`, 'success');
                log('üéØ Ready for console testing!', 'success');
                
                // Make available globally for console access
                window.Parchment = Parchment;
                window.Attributor = Parchment.Attributor;
                window.StyleAttributor = Parchment.StyleAttributor;
                window.ClassAttributor = Parchment.ClassAttributor;
                window.Scope = Parchment.Scope;
                
                log('üåê Classes available globally: Attributor, StyleAttributor, ClassAttributor, Scope');
                log('üí° Try in browser console: new Attributor("test", "data-test")');
                
            } catch (error) {
                log(`‚ùå Initialization failed: ${error.message}`, 'error');
            }
        }
        
        window.runBasicTests = function() {
            log('üß™ Running basic instantiation tests...');
            
            try {
                // Test basic constructors
                const attr1 = new Parchment.Attributor("test1", "data-test1");
                log('‚úÖ Basic Attributor created', 'success');
                
                const attr2 = new Parchment.StyleAttributor("test2", "color");
                log('‚úÖ Basic StyleAttributor created', 'success');
                
                const attr3 = new Parchment.ClassAttributor("test3", "text-align");
                log('‚úÖ Basic ClassAttributor created', 'success');
                
                // Test getters
                log(`üìä Attributor info: name="${attr1.attrName()}", key="${attr1.keyName()}", scope=${attr1.scope()}`);
                log(`üìä StyleAttributor info: name="${attr2.attrName()}", key="${attr2.keyName()}", scope=${attr2.scope()}`);
                log(`üìä ClassAttributor info: name="${attr3.attrName()}", key="${attr3.keyName()}", scope=${attr3.scope()}`);
                
                log('üéâ Basic tests completed successfully!', 'success');
                
            } catch (error) {
                log(`‚ùå Basic test error: ${error.message}`, 'error');
            }
        };
        
        window.runConstructorTests = function() {
            log('üß™ Running constructor pattern tests...');
            
            try {
                // Test all constructor patterns for each type
                log('Testing Attributor constructors...');
                const attr1 = new Parchment.Attributor("basic", "data-basic");
                const attr2 = Parchment.Attributor.newWithScope("scoped", "data-scoped", Parchment.Scope.Inline);
                const attr3 = Parchment.Attributor.newWithWhitelist("whitelist", "data-whitelist", ["a", "b", "c"]);
                const attr4 = Parchment.Attributor.newFull("full", "data-full", Parchment.Scope.Block, ["x", "y", "z"]);
                log('‚úÖ All Attributor constructors work', 'success');
                
                log('Testing StyleAttributor constructors...');
                const style1 = new Parchment.StyleAttributor("basic", "color");
                const style2 = Parchment.StyleAttributor.newWithScope("scoped", "font-size", Parchment.Scope.Inline);
                const style3 = Parchment.StyleAttributor.newWithWhitelist("whitelist", "background-color", ["red", "blue", "green"]);
                const style4 = Parchment.StyleAttributor.newFull("full", "border-color", Parchment.Scope.Block, ["black", "white"]);
                log('‚úÖ All StyleAttributor constructors work', 'success');
                
                log('Testing ClassAttributor constructors...');
                const class1 = new Parchment.ClassAttributor("basic", "text-align");
                const class2 = Parchment.ClassAttributor.newWithScope("scoped", "font-weight", Parchment.Scope.Inline);
                const class3 = Parchment.ClassAttributor.newWithWhitelist("whitelist", "theme", ["light", "dark"]);
                const class4 = Parchment.ClassAttributor.newFull("full", "size", Parchment.Scope.Block, ["sm", "md", "lg"]);
                log('‚úÖ All ClassAttributor constructors work', 'success');
                
                log('üéâ Constructor tests completed successfully!', 'success');
                
            } catch (error) {
                log(`‚ùå Constructor test error: ${error.message}`, 'error');
            }
        };
        
        window.runMethodTests = function() {
            log('üß™ Running method functionality tests...');
            
            try {
                const element = document.getElementById('demo-element');
                
                // Test Attributor methods
                log('Testing Attributor methods...');
                const attr = new Parchment.Attributor("link", "href");
                const addResult1 = attr.add(element, "https://example.com");
                log(`add() result: ${addResult1}`);
                const value1 = attr.value(element);
                log(`value() result: "${value1}"`);
                attr.remove(element);
                log('remove() completed');
                
                // Test StyleAttributor methods
                log('Testing StyleAttributor methods...');
                const styleAttr = new Parchment.StyleAttributor("color", "color");
                const addResult2 = styleAttr.add(element, "red");
                log(`add() result: ${addResult2}`);
                const value2 = styleAttr.value(element);
                log(`value() result: "${value2}"`);
                
                // Test ClassAttributor methods
                log('Testing ClassAttributor methods...');
                const classAttr = new Parchment.ClassAttributor("align", "text-align");
                const addResult3 = classAttr.add(element, "center");
                log(`add() result: ${addResult3}`);
                const value3 = classAttr.value(element);
                log(`value() result: "${value3}"`);
                const className = classAttr.getClassName("left");
                log(`getClassName() result: "${className}"`);
                
                log(`üìä Element state: classes="${element.className}", style="${element.style.cssText}"`);
                
                // Clean up
                styleAttr.remove(element);
                classAttr.remove(element);
                
                log('üéâ Method tests completed successfully!', 'success');
                
            } catch (error) {
                log(`‚ùå Method test error: ${error.message}`, 'error');
            }
        };
        
        window.runErrorTests = function() {
            log('üß™ Running error handling tests...');
            
            try {
                const attr = new Parchment.Attributor("test", "data-test");
                
                // Test null element
                log('Testing null element handling...');
                const nullResult = attr.add(null, "test");
                log(`null element add() result: ${nullResult} (should be false)`);
                
                // Test undefined value
                log('Testing undefined value handling...');
                const element = document.getElementById('demo-element');
                const undefinedResult = attr.add(element, undefined);
                log(`undefined value add() result: ${undefinedResult} (should be false)`);
                
                // Test empty string
                log('Testing empty string handling...');
                const emptyResult = attr.add(element, "");
                log(`empty string add() result: ${emptyResult}`);
                
                // Test whitelist validation
                log('Testing whitelist validation...');
                const restrictedAttr = Parchment.StyleAttributor.newWithWhitelist("restricted", "color", ["red", "blue"]);
                const validResult = restrictedAttr.add(element, "red");
                const invalidResult = restrictedAttr.add(element, "purple");
                log(`valid value result: ${validResult} (should be true)`);
                log(`invalid value result: ${invalidResult} (should be false)`);
                
                log('üéâ Error handling tests completed successfully!', 'success');
                
            } catch (error) {
                log(`‚ùå Error test error: ${error.message}`, 'error');
            }
        };
        
        window.runPerformanceTests = function() {
            log('üß™ Running performance tests...');
            
            try {
                // Test constructor performance
                log('Testing constructor performance...');
                const constructorStart = performance.now();
                for (let i = 0; i < 1000; i++) {
                    new Parchment.Attributor(`test${i}`, `data-test${i}`);
                }
                const constructorTime = performance.now() - constructorStart;
                log(`1000 constructor calls: ${constructorTime.toFixed(2)}ms`);
                
                // Test method performance
                log('Testing method performance...');
                const element = document.getElementById('demo-element');
                const attr = new Parchment.Attributor("perf", "data-perf");
                
                const methodStart = performance.now();
                for (let i = 0; i < 1000; i++) {
                    attr.add(element, `value${i}`);
                    attr.value(element);
                    attr.remove(element);
                }
                const methodTime = performance.now() - methodStart;
                log(`3000 method calls: ${methodTime.toFixed(2)}ms`);
                
                // Test memory usage (if available)
                if (performance.memory) {
                    const memoryUsed = (performance.memory.usedJSHeapSize / 1024 / 1024).toFixed(2);
                    log(`Current memory usage: ${memoryUsed}MB`);
                }
                
                log('üéâ Performance tests completed successfully!', 'success');
                
            } catch (error) {
                log(`‚ùå Performance test error: ${error.message}`, 'error');
            }
        };
        
        // Initialize when page loads
        initialize();
    </script>
</body>
</html>